# 字符集及校对规则

字符集指的是一种从二进制编码到某类字符符号的映射。校对规则则是指某种字符集下的排序规则。MySQL中每一种字符集都会对应一系列的校对规则。

MySQL采用的是类似继承的方式指定字符集的默认值，每个数据库以及每张数据表都有自己的默认值，他们逐层继承。比如：某个库中所有表的默认字符集将是该数据库所指定的字符集（这些表在没有指定字符集的情况下，才会采用默认字符集） PS：整理自《Java工程师修炼之道》

# 索引

## 简介

1. 索引式帮助MySQL高效获取数据的数据结构；
2. 索引的目的在于提高查找效率；
3. 可以理解为“**排好序的快速查找数据结构**”；

## 优势

1. 可以提高数据检索的效率，降低数据库的IO成本；
2. 通过索引列对数据进行排序，降低数据排序的成本，降低了CPU的消耗。

## 劣势

1. 实际上索引也是一个表，该表保存了主键和索引字段，并指向实体表的记录，所以索引列也是要占用空间的。

2. 虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行insert，update，delete。

   因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段。

3. 索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引。

## 分类

### 单值索引

即一个索引只包含单个列，一个表可以有多个单列索引。

### 唯一索引

索引的列的值必须唯一，但允许有空值。

### 复合索引

即一个索引包含多个列。

## 结构

MySQL索引使用的数据结构主要有**BTree索引** 和 **哈希索引** 。对于哈希索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景，建议选择BTree索引。

MySQL的BTree索引使用的是B数中的B+Tree，但对于主要的两种存储引擎的实现方式是不同的。

- **MyISAM:** B+Tree叶节点的data域存放的是数据记录的地址。在索引检索的时候，首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其 data 域的值，然后以 data 域的值为地址读取相应的数据记录。这被称为“非聚簇索引”。
- **InnoDB:** 其数据文件本身就是索引文件。相比MyISAM，索引文件和数据文件是分离的，其表数据文件本身就是按B+Tree组织的一个索引结构，树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。这被称为“聚簇索引（或聚集索引）”。而其余的索引都作为辅助索引，辅助索引的data域存储相应记录主键的值而不是地址，这也是和MyISAM不同的地方。**在根据主索引搜索时，直接找到key所在的节点即可取出数据；在根据辅助索引查找时，则需要先取出主键的值，再走一遍主索引。** **因此，在设计表的时候，不建议使用过长的字段作为主键，也不建议使用非单调的字段作为主键，这样会造成主索引频繁分裂。**

## 创建索引的情况

* 主键自动建立唯一索引
* 频繁作为查询条件的字段应该创建索引
* 查询中与其它表关联的字段，外键关系建立索引
* 频繁更新的字段不适合创建索引
* where条件用不到的字段不创建索引
* 单间/组合索引的选择问题（在搞并发下倾向创建组合索引）
* 查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度
* 查询中统计或者分组字段

## 不要创建索引的情况

* 表记录太少

* 经常增删改的表

  > 提高了查询速度，同时会降低更新表的速度，如对表进行insert、update、delete。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。

* 数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。

  > 注意：如果某个数据列包含许多重复的内容，为她建立索引就没有太大的实际效果。

